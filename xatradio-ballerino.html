<script>
    const player = document.getElementById('player');
    const volumeSlider = document.getElementById('volume-slider');
    const albumArt = document.getElementById('album-art');
    const coverGrid = document.getElementById('cover-grid');
    const currentTitle = document.getElementById('currentTitle');
    const playBtn = document.getElementById('play');
    const stopBtn = document.getElementById('stop');
    const introVideo = document.getElementById('intro-video');
    const backgroundVideo = document.getElementById('background-video');

    let introTimeout = null;
    let videoIndex = 0;
    const videos = [
        "https://peppeagosto.github.io/immaggini/38.mp4", 
        "https://peppeagosto.github.io/immaggini/83.mp4",
        "https://peppeagosto.github.io/immaggini/34.mp4"
    ];

    playBtn.addEventListener('click', () => {
        playBtn.style.pointerEvents = 'none';
        introVideo.style.display = 'block';
        introVideo.currentTime = 0;
        introVideo.play();

        introTimeout = setTimeout(() => {
            introVideo.pause();
            introVideo.style.display = 'none';
            player.play();
            playBtn.style.pointerEvents = 'auto';
        }, 15000);
    });

    stopBtn.addEventListener('click', () => {
        if (introTimeout) {
            clearTimeout(introTimeout);
            introTimeout = null;
        }

        introVideo.pause();
        introVideo.style.display = 'none';

        player.pause();
        player.currentTime = 0;

        playBtn.style.pointerEvents = 'auto';
    });

    volumeSlider.addEventListener('input', (e) => {
        player.volume = e.target.value;
    });

    setInterval(() => {
        videoIndex = (videoIndex + 1) % videos.length;
        backgroundVideo.src = videos[videoIndex];
    }, 15000);

    // === METADATI RADIO DA ZENO.FM ===
    async function updateTitleAndCover() {
        try {
            const response = await fetch("https://api.zeno.fm/station_metadata/metadata/mcrnn0ibuzatv");
            const data = await response.json();
            if (data && data.title) {
                currentTitle.textContent = data.title;

                // Esempio semplice per cover casuali (puoi legarle al titolo con un tuo DB)
                const covers = [
                    'https://xatimg.com/image/1AvB7cLMknZ7.gif',
                    'https://xatimg.com/image/o1z8Yt1rG7Z2.png',
                    'https://xatimg.com/image/gks8YcXNjw9v.png',
                    'https://xatimg.com/image/2BkhzaxtzhPf.gif'
                ];

                // Cambia la copertina principale
                albumArt.style.backgroundImage = `url('${covers[Math.floor(Math.random() * covers.length)]}')`;

                // Riempie la griglia di cover
                coverGrid.innerHTML = '';
                covers.forEach(src => {
                    const div = document.createElement('div');
                    div.className = 'cover';
                    div.innerHTML = `<img src="${src}" alt="cover">`;
                    coverGrid.appendChild(div);
                });
            }
        } catch (error) {
            console.error("Errore nel recupero metadati:", error);
            currentTitle.textContent = "Titolo non disponibile";
        }
    }

    setInterval(updateTitleAndCover, 10000); // aggiorna ogni 10 secondi
    updateTitleAndCover(); // subito al caricamento
</script>

