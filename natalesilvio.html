<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NATALE by Diablo</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    background:#8b0000;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    font-family:Arial,sans-serif;
    overflow:hidden;
    position:relative;
  }
  #container {
    position: relative;
    width:700px;
    height:750px;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index:10;
  }
  #box {
    width:400px;
    height:520px;
    background:rgba(0,0,0,0.45);
    border-radius:20px;
    box-shadow:0 0 20px red;
    text-align:center;
    padding:20px;
    z-index:12;
    position:relative;
    backdrop-filter: blur(5px);
  }
  #titolocanzone {
    width:100%;
    background:linear-gradient(to right,#ff0000,#a00000,#ff0000);
    padding:12px;
    color:#fff;
    font-size:22px;
    font-weight:bold;
    border-radius:12px;
    overflow:hidden;
    margin-bottom:20px;
    white-space: nowrap;
  }
  #titolocanzone span {
    display:inline-block;
    padding-left:100%;
    animation:scrollTitle 15s linear infinite, rainbowText 5s linear infinite;
  }
  @keyframes scrollTitle {
    0%{transform:translateX(100%);}
    100%{transform:translateX(-100%);}
  }
  @keyframes rainbowText {
    0%{color:#ff0000;}50%{color:#ffff00;}100%{color:#ff0000;}
  }
  #album-art {
    width:130px;
    height:130px;
    margin:0 auto 15px;
    border-radius:50%;
    overflow:hidden;
    box-shadow:0 0 15px #ff0000;
    border:3px solid #fff;
    background-size: cover;
    background-position: center;
    transition: transform 0.5s ease;
  }
  #album-art.pulse { animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.12);} }
  #album-art.no-cover { background-image: url('https://xatimg.com/image/xmTZE8IRcKFj.gif'); }

  #controls { display:flex; justify-content:center; align-items:center; gap:10px; flex-wrap:nowrap; margin-top:15px; }
  .btn-xmas { width:60px; height:60px; background:transparent; border:none; cursor:pointer; position:relative; border-radius:50%; box-shadow:0 0 10px red; transition:0.2s; }
  #play { background-image:url('https://xatimg.com/image/pElJqwm2CuHl.png'); background-size:cover; background-position:center; }
  #stop { background-image:url('https://xatimg.com/image/pElJqwm2CuHl.png'); background-size:cover; background-position:center; }
  .btn-xmas:hover { transform:scale(1.1); opacity:0.8; }

  input[type=range]{-webkit-appearance:none;background:transparent;}
  input[type=range]::-webkit-slider-runnable-track{height:6px;background:#ff0000;border-radius:3px;}
  input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:#fff;border:2px solid red;border-radius:50%;margin-top:-6px;cursor:pointer;}
  #volume-slider { width:100px; }

  .mp4-side {
    position:absolute; top:50%; width:180px; height:500px;
    transform:translateY(-50%); object-fit:cover; z-index:1;
    border-radius:15px; box-shadow:0 0 20px rgba(255,0,0,0.6); opacity:0.8;
  }
  #leftVideo{left:-150px;}
  #rightVideo{right:-150px;}

  .snowflake {
    position:absolute; top:-15px; width:6px; height:6px; background:#fff; border-radius:50%;
    pointer-events:none; user-select:none; animation:fall linear infinite;
    z-index:5; box-shadow:0 0 6px rgba(255,255,255,0.8); opacity:0.9;
  }
  @keyframes fall { 0%{transform:translateY(0) translateX(0) rotate(0deg); opacity:0.9;} 100%{transform:translateY(110vh) translateX(30px) rotate(360deg); opacity:0;} }

  /* COMETA */
  #comet-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 20px;
    height: 20px;
    z-index: 20;
    pointer-events: none;
  }
  #comet {
    width: 20px;
    height: 20px;
    background: yellow;
    clip-path: polygon(
      50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%,
      50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%
    );
    box-shadow: 0 0 10px yellow, 0 0 20px gold;
    position: relative;
  }
  #comet-tail {
    position: absolute;
    top: 10px;
    left: -10px;
    width: 50px;
    height: 10px;
    background: linear-gradient(to right, rgba(255,255,0,0.8), rgba(255,255,0,0.2), rgba(255,255,0,0));
    transform-origin: left center;
    filter: blur(3px);
  }

  /* TESTO LAMPEGGIANTE AUGURI */
  #auguri-msg {
    position:absolute;
    top:10px;
    width:100%;
    text-align:center;
    font-size:26px;
    font-weight:bold;
    color:#fff;
    text-shadow:0 0 12px red, 0 0 20px yellow;
    animation:blink 1s infinite;
    display:none;
    z-index:30;
  }
  @keyframes blink {
    0%{opacity:1;}
    50%{opacity:0.2;}
    100%{opacity:1;}
  }

</style>
</head>
<body>

<div id="container">

  <div id="auguri-msg">ATTENDI CHE FINISCE GLI AUGURI…</div>

  <video id="leftVideo" class="mp4-side" src="https://peppeagosto.github.io/immaggini/2025.mp4" autoplay loop muted playsinline></video>
  <video id="rightVideo" class="mp4-side" src="https://peppeagosto.github.io/immaggini/2025.mp4" autoplay loop muted playsinline></video>

  <div id="box">
    <div id="titolocanzone"><span></span></div>
    <div id="album-art" class="no-cover"></div>

    <div id="controls">
      <button id="play" class="btn-xmas"></button>
      <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8">
      <button id="stop" class="btn-xmas"></button>
    </div>

    <audio id="player" src="https://stream-164.zeno.fm/mcrnn0ibuzatv" preload="auto"></audio>
    <audio id="silvio" src="https://peppeagosto.github.io/immaggini/silvio.mp3"></audio>

  </div>
</div>

<!-- COMETA -->
<div id="comet-container">
  <div id="comet"></div>
  <div id="comet-tail"></div>
</div>

<script>
// ELEMENTI
const player = document.getElementById("player");
const silvio = document.getElementById("silvio");
const playBtn = document.getElementById("play");
const stopBtn = document.getElementById("stop");
const volumeSlider = document.getElementById("volume-slider");
const albumArt = document.getElementById("album-art");
const currentTitle = document.querySelector('#titolocanzone span');
const auguriMsg = document.getElementById("auguri-msg");

const nowPlayingUrl = 'https://zenoplay.zenomedia.com/api/zenofm/nowplaying/ylkruiq5e4fvv';
const defaultCover = 'https://xatimg.com/image/xmTZE8IRcKFj.gif';

let lastTitle = '';
let firstPlay = true;

// PLAY
playBtn.addEventListener("click", () => {

  if(firstPlay){
    // PRIMA VOLTA → PARTE SILVIO
    auguriMsg.style.display = "block";
    silvio.play();
    silvio.volume = volumeSlider.value;

    // dopo 54 sec parte lo streaming
    setTimeout(()=>{
      auguriMsg.style.display = "none";
      player.play();
      albumArt.classList.add('pulse');
      fetchNowPlaying();
      firstPlay = false;
    }, 54000);

  } else {
    // DOPO LA PRIMA VOLTA → STREAMING DIRETTO
    player.play();
    albumArt.classList.add('pulse');
  }
});

// STOP
stopBtn.addEventListener("click", () => {
  player.pause();
  silvio.pause();
  silvio.currentTime = 0;
  player.currentTime = 0;
  albumArt.classList.remove('pulse');
  auguriMsg.style.display = "none";
});

// VOLUME
volumeSlider.addEventListener("input", () => {
  player.volume = volumeSlider.value;
  silvio.volume = volumeSlider.value;
});

// FETCH NOW PLAYING
async function fetchNowPlaying(){
  try{
    const res = await fetch(`${nowPlayingUrl}?t=${Date.now()}`, {cache:'no-store'});
    const data = await res.json();
    const title = data.title || 'Titolo non disponibile';
    const artist = data.artist || '';

    if(title !== lastTitle){
      lastTitle = title;
      currentTitle.textContent = title;

      currentTitle.style.animation = 'none';
      currentTitle.offsetHeight;
      currentTitle.style.animation = 'scrollTitle 15s linear infinite, rainbowText 5s linear infinite';

      const query = encodeURIComponent(title + ' ' + artist);
      const url = `https://itunes.apple.com/search?term=${query}&limit=1&entity=song`;

      try{
        const c = await fetch(url, {cache:'no-store'});
        const d = await c.json();
        if(d.results && d.results[0] && d.results[0].artworkUrl100){
          albumArt.style.backgroundImage = `url(${d.results[0].artworkUrl100.replace('100x100','600x600')})`;
        } else {
          albumArt.style.backgroundImage = `url(${defaultCover})`;
        }
      } catch(e){
        albumArt.style.backgroundImage = `url(${defaultCover})`;
      }
    }
  } catch(e){
    currentTitle.textContent = 'Errore caricamento titolo';
    albumArt.style.backgroundImage = `url(${defaultCover})`;
  }
}

setInterval(fetchNowPlaying, 8000);

// NEVE
function createSnowflake(){
  const flake=document.createElement('div');
  flake.classList.add('snowflake');
  flake.style.left=Math.random()*100+'vw';
  const duration=Math.random()*7+8;
  flake.style.animationDuration=duration+'s';
  const size=Math.random()*4+3;
  flake.style.width=size+'px';
  flake.style.height=size+'px';
  document.body.appendChild(flake);
  setTimeout(()=>flake.remove(), duration*1000+1000);
}
setInterval(createSnowflake,200);
for(let i=0;i<40;i++){ createSnowflake(); }

// COMETA
const cometContainer=document.getElementById('comet-container');
let posX=0,posY=0;
let dirX=1,dirY=1;

function moveComet(){
  const speed=3;
  const maxX=window.innerWidth-50;
  const maxY=window.innerHeight-50;

  posX+=speed*dirX;
  posY+=speed*dirY;

  if(posX>=maxX || posX<=0) dirX*=-1;
  if(posY>=maxY || posY<=0) dirY*=-1;

  cometContainer.style.left=posX+'px';
  cometContainer.style.top=posY+'px';

  requestAnimationFrame(moveComet);
}
moveComet();
</script>

</body>
</html>
