<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Il Cartaio - Buon Natale</title>
  <style>
    *{margin:0;padding:0}
    body,html{
      height:100vh;
      overflow:hidden;
      background:#000;
      display:flex;
      justify-content:center;
      align-items:center;
      font-family:Arial,sans-serif;
      position:relative
    }
    .container{
      position:relative;
      width:1308px;
      height:486px
    }
    .vid{
      position:absolute;
      top:0;
      width:290px;
      height:486px;
      object-fit:cover;
      border-radius:10px;
      box-shadow:0 0 20px rgba(255,0,0,.7);
      z-index:2
    }
    .left{left:-40px}
    .right{right:-40px}
    canvas{
      position:fixed;
      top:0;
      left:0;
      pointer-events:none
    }
    #stars-canvas{z-index:1}
    #snow-canvas{z-index:3}
    #comet-canvas{z-index:5}
    .text{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      font-size:3.5em;
      color:#ff3333;
      font-weight:bold;
      text-shadow:0 0 20px #ff0000,0 0 40px #ff3333;
      animation:pulse 2s infinite;
      z-index:4;
      white-space:nowrap
    }
    @keyframes pulse{
      0%,100%{text-shadow:0 0 20px #ff0000}
      50%{text-shadow:0 0 40px #ff3333,0 0 60px #ff0000}
    }
    audio{display:none}
  </style>
</head>
<body>
  <div class="container">
    <video class="vid left" autoplay loop muted playsinline>
      <source src="https://peppeagosto.github.io/immaggini/25.mp4" type="video/mp4">
    </video>

    <!-- VIDEO DESTRO CORRETTO -->
    <video class="vid right" autoplay loop muted playsinline>
      <source src="https://peppeagosto.github.io/immaggini/25.mp4" type="video/mp4">
    </video>
  </div>

  <div class="text">BUON NATALE</div>

  <canvas id="stars-canvas"></canvas>
  <canvas id="snow-canvas"></canvas>
  <canvas id="comet-canvas"></canvas>

  <!-- AUDIO AUTOMATICO OGNI 25 SECONDI -->
  <audio id="voce" preload="auto">
    <source src="https://peppeagosto.github.io/immaggini/25.m4a">
  </audio>

  <script>
    // === CANVAS SETUP ===
    const canvases = ['stars-canvas','snow-canvas','comet-canvas'].map(id=>document.getElementById(id));
    const ctxs = canvases.map(c=>c.getContext('2d'));
    const [sctx,nctx,cctx]=ctxs;
    const resize=()=>canvases.forEach(c=>{c.width=innerWidth;c.height=innerHeight});
    resize();window.onresize=resize;

    // === STELLE ===
    const stars=[],numStars=160;
    class Star{
      constructor(){this.reset();}
      reset(){
        this.size=Math.random()*3.2+1;
        this.x=Math.random()*innerWidth;
        this.y=-60;
        this.speed=Math.random()*1.8+0.6;
        this.time=0;this.duration=Math.random()*18+12;
        this.phase=Math.random()*Math.PI*2;
      }
      update(){
        this.time+=0.016;this.y+=this.speed;
        if(this.time>this.duration||this.y>innerHeight+60)this.reset();
      }
      draw(){
        const pulse=0.75+0.25*Math.sin(this.time*6+this.phase);
        sctx.globalAlpha=pulse;
        sctx.shadowBlur=22;sctx.shadowColor='#fff';
        sctx.beginPath();sctx.arc(this.x,this.y,this.size,0,Math.PI*2);
        sctx.fillStyle='#fff';sctx.fill();
        if(this.size>2.3){
          sctx.shadowBlur=35;sctx.shadowColor='#ffd700';
          drawStar(sctx,this.x,this.y,this.size*2.2,this.size*0.9);
        }
      }
    }
    for(let i=0;i<numStars;i++)stars.push(new Star());
    function animateStars(){
      sctx.clearRect(0,0,innerWidth,innerHeight);
      stars.forEach(s=>{s.update();s.draw();});
      requestAnimationFrame(animateStars);
    }
    animateStars();

    // === NEVE ===
    const flakes=[],numFlakes=80;
    class Flake{
      constructor(){this.reset();}
      reset(){
        this.x=Math.random()*innerWidth;
        this.y=-10;
        this.size=Math.random()*2+1;
        this.speed=Math.random()*1+0.5;
        this.opacity=Math.random()*0.5+0.5;
        this.wind=Math.random()*2-1;
      }
      update(){
        this.y+=this.speed;
        this.x+=this.wind*0.3;
        if(this.y>innerHeight||this.x<-20||this.x>innerWidth+20)this.reset();
      }
      draw(){
        nctx.globalAlpha=this.opacity;
        nctx.fillStyle='#fff';
        nctx.beginPath();
        nctx.arc(this.x,this.y,this.size,0,Math.PI*2);
        nctx.fill();
      }
    }
    for(let i=0;i<numFlakes;i++)flakes.push(new Flake());
    function animateSnow(){
      nctx.clearRect(0,0,innerWidth,innerHeight);
      flakes.forEach(f=>{f.update();f.draw();});
      requestAnimationFrame(animateSnow);
    }
    animateSnow();

    // === COMETA ===
    const comet={x:-300,y:0,speed:1.8,size:28,trail:[],maxTrail:50};
    function resetComet(){
      const t=document.querySelector('.text').getBoundingClientRect();
      comet.y=t.top+t.height*0.3;
      comet.x=-300;
      comet.trail=[];
    }
    resetComet();
    function drawStar(ctx,cx,cy,R,r){
      let rot=Math.PI/2*3;
      ctx.beginPath();ctx.moveTo(cx,cy-R);
      for(let i=0;i<5;i++){
        ctx.lineTo(cx+Math.cos(rot)*R,cy+Math.sin(rot)*R);rot+=Math.PI/5;
        ctx.lineTo(cx+Math.cos(rot)*r,cy+Math.sin(rot)*r);rot+=Math.PI/5;
      }
      ctx.closePath();
      const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,R);
      grad.addColorStop(0,'#ffffff');
      grad.addColorStop(0.4,'#fff8a8');
      grad.addColorStop(1,'#ffdc64');
      ctx.fillStyle=grad;
      ctx.fill();
    }
    function animateComet(){
      cctx.clearRect(0,0,innerWidth,innerHeight);
      comet.x+=comet.speed;
      comet.trail.push({x:comet.x,y:comet.y});
      if(comet.trail.length>comet.maxTrail)comet.trail.shift();
      comet.trail.forEach((p,i)=>{
        const alpha=(i+1)/comet.trail.length;
        cctx.globalAlpha=alpha*0.7;
        cctx.shadowBlur=30;
        cctx.shadowColor=`rgba(255,220,100,${alpha})`;
        cctx.beginPath();
        cctx.arc(p.x,p.y,comet.size*0.5*alpha,0,Math.PI*2);
        cctx.fillStyle='#ffdc64';
        cctx.fill();
      });
      cctx.globalAlpha=1;
      cctx.shadowBlur=60;
      cctx.shadowColor='#ffd700';
      drawStar(cctx,comet.x,comet.y,comet.size,comet.size*0.45);
      if(comet.x>innerWidth+300)resetComet();
      requestAnimationFrame(animateComet);
    }
    setTimeout(animateComet,1000);

    // === AUDIO AUTOMATICO OGNI 25 SECONDI ===
    const audio=document.getElementById('voce');
    function play25(){
      audio.currentTime=0;
      audio.play().catch(()=>console.log("Audio in attesa di interazione utente"));
    }
    // prima riproduzione
    setTimeout(play25,1500);
    // loop infinito ogni 25s
    setInterval(play25,25000);
  </script>
</body>
</html>

